# Conditional XFAIL settings: Additions for the lockless mode of the VCI branch
#
# Syntax (similar to a cron file):
#   [jobname] [compiler] [jenkins_configure] [netmod] [shmem_config] [force_am] [pmix] [sed of XFAIL]
#   Note that the [jobname] allows partial matches (see examples). Other
#   conditions only allows exact matches.
#   The actual allowed combinations are depending on the Jenkins job. For
#   example,
#   per-commit * * opa1x * * sed -i "..."
#   will have no effect since none of the per-commit jobs has opa1x netmod in the
#   configuration.
#
# Examples:
#   nightly gnu debug sockets exclusive noam sed -i "..."
#   This will apply the set the XFAIL when the job is "nightly-ancc" or
#   "nightly", the compiler is "gnu", the jenkins_configure is
#   "debug", provider is "sockets", shm configuration is "exclusive",
#   and force_am configuration is "noam".
#
# Important note:
#   The BSD sed on FreeBSD and OSX nodes has different parameters than the GNU
#   sed. You should use `gsed` than `sed` on them.
#
# For each build, all applied XFAILS will be summarized in
# ${SOURCE}/apply-xfail.sh
#
################################################################################

# Normal tests
* * * * * * * sed -i "s+\(^atomic_get_short_int .*\)+\1 xfail=pmodels/mpich#3380+g" test/mpi/rma/testlist
* * * * * noam * sed -i "s+\(comm_idup .*\)+\1 xfail=csr/mpich-ofi#2092+g" test/mpi/comm/testlist
* * * psm2 * * * sed -i "s+\(^lock_contention_dt 4 arg=-type=MPI_INT arg=-count=1 arg=-seed=.* arg=-testsize=1024  .*\)+\1 xfail=pmodels/mpich#2381+g" test/mpi/rma/testlist.dtp
* * * psm2 * * * sed -i "s+\(^lockall_dt 4 arg=-type=MPI_INT arg=-count=1 arg=-seed=.* arg=-testsize=1024  .*\)+\1 xfail=pmodels/mpich#2381+g" test/mpi/rma/testlist.dtp
* * * psm2 * * * sed -i "s+\(^lockall_dt_flush 4 arg=-type=MPI_INT arg=-count=1 arg=-seed=.* arg=-testsize=1024  .*\)+\1 xfail=pmodels/mpich#2381+g" test/mpi/rma/testlist.dtp
* * * psm2 * * * sed -i "s+\(^lockall_dt_flushall 4 arg=-type=MPI_INT arg=-count=1 arg=-seed=.* arg=-testsize=1024  .*\)+\1 xfail=pmodels/mpich#2381+g" test/mpi/rma/testlist.dtp
* * * psm2 * * * sed -i "s+\(^lockall_dt_flushlocal 4 arg=-type=MPI_INT arg=-count=1 arg=-seed=.* arg=-testsize=1024  .*\)+\1 xfail=pmodels/mpich#2381+g" test/mpi/rma/testlist.dtp
* * * psm2 * * * sed -i "s+\(^lockall_dt_flushlocalall 4 arg=-type=MPI_INT arg=-count=1 arg=-seed=.* arg=-testsize=1024  .*\)+\1 xfail=pmodels/mpich#2381+g" test/mpi/rma/testlist.dtp

# These are actually vci4 only
* * * psm2 * noam * sed -i "s+\(^cmsplit2 .*\)+\1 xfail=csr/mpich-ofi#2125+g" test/mpi/comm/testlist
* gnu default psm2 no-odd-even noam * sed -i "s+\(^gtranksperf .*\)+\1 xfail=csr/mpich-ofi#2125+g" test/mpi/group/testlist
* gnu debug psm2 auto noam * sed -i "s+\(^gtranksperf .*\)+\1 xfail=csr/mpich-ofi#2125+g" test/mpi/group/testlist
* * * sockets netmod noam * sed -i "s+\(^p_allred .* env=MPIR_CVAR_ALLREDUCE_INTRA_ALGORITHM=recexch env=MPIR_CVAR_ALLREDUCE_RECEXCH_KVAL=[45].*\)+\1 xfail=csr/mpich-ofi#2065+g" test/mpi/coll/testlist.cvar
* * * sockets netmod noam * sed -i "s+\(^p_allred .* env=MPIR_CVAR_ALLREDUCE_INTRA_ALGORITHM=tree env=MPIR_CVAR_ALLREDUCE_TREE_PIPELINE_CHUNK_SIZE=0 env=MPIR_CVAR_ALLREDUCE_TREE_KVAL=3 env=MPIR_CVAR_ALLREDUCE_TREE_TYPE=knomial_1.*\)+\1 xfail=csr/mpich-ofi#2065+g" test/mpi/coll/testlist.cvar
* gnu default sockets no-odd-even noam * sed -i "s+\(i_aggregation1 4\)+\1 xfail=csr/mpich-ofi#2130+g" test/mpi/io/testlist

# MT tests
* * * * * * * sed -i "s+\(^mt_ibsendirecv .*\)+\1 xfail=csr/mpich-ofi#1699+g" test/mpi/threads/pt2pt/testlist
* * * sockets * * * sed -i "s+\(^mt_accfence_huge .*\)+\1 xfail=csr/mpich-ofi#2259,2288+g" test/mpi/threads/rma/testlist
* * * * * * * sed -i "s+\(^mt_reqops .*\)+\1 xfail=csr/mpich-ofi#2274,2288+g" test/mpi/threads/rma/testlist
* * * sockets * * * sed -i "s+\(^mt_getaccfence_huge .*\)+\1 xfail=csr/mpich-ofi#2288+g" test/mpi/threads/rma/testlist
* * * psm2 * * * sed -i "s+\(^multisend4 .*\)+\1 xfail=csr/mpich-ofi#2330+g" test/mpi/threads/pt2pt/testlist
* * debug psm2 netmod * * sed -i "s+\(^multisend2 5\)+\1 xfail=csr/mpich-ofi#2349+g" test/mpi/threads/pt2pt/testlist
* * debug psm2 auto * * sed -i "s+\(^multisend2 5\)+\1 xfail=csr/mpich-ofi#2349+g" test/mpi/threads/pt2pt/testlist
* * * sockets netmod * * sed -i "s+\(^mt_mprobe_sendirecv .*arg=-iter=1024 .*arg=-count=1 .*\)+\1 xfail=csr/mpich-ofi#2331+g" test/mpi/threads/pt2pt/testlist
* * * sockets auto * * sed -i "s+\(^mt_mprobe_sendrecv 2 arg=-iter=1024 arg=-count=1.*\)+\1 xfail=csr/mpich-ofi#2346+g" test/mpi/threads/pt2pt/testlist
* * * sockets netmod * * sed -i "s+\(^mt_mprobe_sendirecv .*arg=-iter=1024 .*arg=-count=1 .*\)+\1 xfail=csr/mpich-ofi#2331+g" test/mpi/threads/pt2pt/testlist
* * * sockets auto * * sed -i "s+\(^mt_mprobe_sendrecv 2 arg=-iter=1024 arg=-count=1.*\)+\1 xfail=csr/mpich-ofi#2346+g" test/mpi/threads/pt2pt/testlist
* * * sockets netmod * * sed -i "s+\(^mt_mprobe_sendrecv 2 arg=-iter=1024 arg=-count=1.*\)+\1 xfail=csr/mpich-ofi#2346+g" test/mpi/threads/pt2pt/testlist
* * * sockets netmod * * sed -i "s+\(^mt_mprobe_isendrecv 2 arg=-iter=1024 arg=-count=1.*\)+\1 xfail=csr/mpich-ofi#2346+g" test/mpi/threads/pt2pt/testlist
* * * * no-odd-even * * sed -i "s+\(^mt_bsendrecv_huge 2 arg=-iter=.* arg=-count=4194304.*\)+\1 xfail=csr/mpich-ofi#2407+g" test/mpi/threads/pt2pt/testlist
* * * * no-odd-even * * sed -i "s+\(^mt_ibsendirecv_huge 2 arg=-iter=.* arg=-count=4194304.*\)+\1 xfail=csr/mpich-ofi#2407+g" test/mpi/threads/pt2pt/testlist
* * * * * * * sed -i "s+\(^mt_ibsendrecv_pers_huge 2 arg=-iter=.* arg=-count=4194304.*\)+\1 xfail=csr/mpich-ofi#2379+g" test/mpi/threads/pt2pt/testlist
