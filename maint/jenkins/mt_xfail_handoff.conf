# Conditional XFAIL settings: Additions for the handoff mode of the VCI branch
#
# Syntax (similar to a cron file):
#   [jobname] [compiler] [config] [provider] [direct] [am] [pmix] [sed of XFAIL]
#   Note that the [jobname] allows partial matches (see examples). Other
#   conditions only allows exact matches.
#   The actual allowed combinations are depending on the Jenkins job. For
#   example,
#   per-commit * * opa1x * * sed -i "..."
#   will have no effect since none of the per-commit jobs has opa1x netmod in the
#   configuration.
#
# Examples:
#   nightly gnu debug sockets exclusive noam sed -i "..."
#   This will apply the set the XFAIL when the job is "nightly-ancc" or
#   "nightly", the compiler is "gnu", the jenkins_configure is
#   "debug", provider is "sockets", shm configuration is "exclusive",
#   and force_am configuration is "noam".
#
# Important note:
#   The BSD sed on FreeBSD and OSX nodes has different parameters than the GNU
#   sed. You should use `gsed` than `sed` on them.
#
# For each build, all applied XFAILS will be summarized in
# ${SOURCE}/apply-xfail.sh
#
################################################################################

# Disable subdirectories
* * * * * * *  /ft/  disable  test/mpi/testlist

# Disable rma atomic test requiring AM path
* * * * * * *             /^atomic_get_2int .*/             xfail=csr/mpich-ofi#1684  test/mpi/rma/testlist
* * * * * * *             /^atomic_get_long_int .*/         xfail=csr/mpich-ofi#1684  test/mpi/rma/testlist
* * * * * * *             /^atomic_get_float_int .*/        xfail=csr/mpich-ofi#1684  test/mpi/rma/testlist
* * * * * * *             /^atomic_get_double_int .*/       xfail=csr/mpich-ofi#1684  test/mpi/rma/testlist
* * * * * * *             /^atomic_get_long_double_int .*/  xfail=csr/mpich-ofi#1684  test/mpi/rma/testlist
* * * * * * *             /^atomic_rmw_cas .*/              xfail=csr/mpich-ofi#1684  test/mpi/rma/testlist
* * * * no-odd-even * *   /^atomic_get_short_int .*/        xfail=csr/mpich-ofi#1908  test/mpi/rma/testlist

# MT tests
* * * * * * *                   /^mt_compareandswap .*/   xfail=csr/mpich-ofi#1319  test/mpi/threads/rma/testlist
* * debug * * * *               /^multifence .*/          xfail=csr/mpich-ofi#1319  test/mpi/threads/rma/testlist
* gnu default psm2 auto noam *  /^multirma .*/            xfail=csr/mpich-ofi#2258  test/mpi/threads/rma/testlist

# Non-MT tests
# (from master) pingping tests with large testsize currently fails async tests due to netmod handling of large message queue
* * * * * * *                           /^pingping .*testsize=32.*/         xfail=issue4474           test/mpi/pt2pt/testlist.dtp
* gnu debug psm2 netmod * *             /^large_small_acc 2.*/              xfail=csr/mpich-ofi#2131  test/mpi/rma/testlist
* icc debug psm2 netmod no-odd-even *   /^large_small_acc 2.*/              xfail=csr/mpich-ofi#2131  test/mpi/rma/testlist
* * * * * * *                           /^lockall_dt.*/                     xfail=csr/mpich-ofi#1744  test/mpi/rma/testlist.dtp
* * * psm2 * * *                        /^lock_dt .*/                       xfail=csr/mpich-ofi#1975  test/mpi/rma/testlist.dtp
* * * psm2 * * *                        /^lock_dt_flush .*/                 xfail=csr/mpich-ofi#1975  test/mpi/rma/testlist.dtp
* * * psm2 * * *                        /^lockall_dt_flushall .*/           xfail=csr/mpich-ofi#1975  test/mpi/rma/testlist.dtp
* gnu default psm2 auto * *             /^lock_dt_flushlocal 2 -type=MPI_INT -count=65530 -seed=182 -testsize=16 .*/  xfail=csr/mpich-ofi#2135  test/mpi/rma/testlist.dtp
* * * * * * *                           /^accfence1.* .*/                   xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist.dtp
* * * * * * *                           /^getfence1.* .*/                   xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist.dtp
* * * * * * *                           /^epochtest[a-z0-9A-Z_]* .*/        xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist.dtp
* * * * * * *                           /^manyrma2[a-z0-9A-Z_]* .*/         xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist
* * * * * * *                           /^fetch_and_op[a-z0-9A-Z_]* .*/     xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist
* * * * * * *                           /^get_accumulate_[a-z0-9A-Z_]* .*/  xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist
* * * * * * *                           /^at_complete .*/                   xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist
* * debug * * * *                       /^win_shared_noncontig_put .*/      xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist
* * debug * * * *                       /^acc_ordering .*/                  xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist
* * debug * * * *                       /^win_dynamic_acc .*/               xfail=csr/mpich-ofi#1319  test/mpi/rma/testlist
* * * * * * *                           /^winfencex .*/                     xfail=csr/mpich-ofi#1938  test/mpi/cxx/rma/testlist
* * debug * * * *                       /^winfencef .*/                     xfail=csr/mpich-ofi#1938  test/mpi/f77/rma/testlist
* * debug * * * *                       /^winfencef90 .*/                   xfail=csr/mpich-ofi#1938  test/mpi/f90/rma/testlist
* * debug * * * *                       /^wingetf .*/                       xfail=csr/mpich-ofi#1938  test/mpi/f77/rma/testlist
* * debug * * * *                       /^wingetf90 .*/                     xfail=csr/mpich-ofi#1938  test/mpi/f90/rma/testlist
* * debug * * * *                       /^wingetf08 .*/                     xfail=csr/mpich-ofi#1938  test/mpi/f08/rma/testlist
* * debug * * * *                       /^mixedsync .*/                     xfail=csr/mpich-ofi#1939  test/mpi/rma/testlist
* * debug * * * *                       /^winaccf .*/                       xfail=csr/mpich-ofi#1939  test/mpi/f77/rma/testlist
* * debug * * * *                       /^winaccf90 .*/                     xfail=csr/mpich-ofi#1939  test/mpi/f90/rma/testlist
* * debug * * * *                       /^winaccf08 .*/                     xfail=csr/mpich-ofi#1939  test/mpi/f08/rma/testlist
* * * psm2 auto * *                     /^lock_contention_dt 4 arg=-type=MPI_INT arg=-count=65530 arg=-seed=149 arg=-testsize=16 .*/  xfail=csr/mpich-ofi#1974  test/mpi/rma/testlist.dtp
* * debug * * * *                       /^putfence1 .*/                     xfail=csr/mpich-ofi#1369  test/mpi/rma/testlist.dtp
* gnu default * auto * *                /^acc_loc .*/                       xfail=csr/mpich-ofi#1931  test/mpi/rma/testlist

* gnu default psm2 auto * *  /^allred5 5 env=MPIR_CVAR_ALLREDUCE_DEVICE_COLLECTIVE=0 env=MPIR_CVAR_ALLREDUCE_INTRA_ALGORITHM=nb env=MPIR_CVAR_IALLREDUCE_DEVICE_COLLECTIVE=0.*/  xfail=csr/mpich-ofi#1986  test/mpi/coll/testlist.cvar

* * * * no-odd-even * *         /^redscatbkinter .*/        xfail=csr/mpich-ofi#1999  test/mpi/coll/testlist
* icc default psm2 auto * *     /^redscatbkinter 10 .*/     xfail=csr/mpich-ofi#2136  test/mpi/coll/testlist
* * * sockets no-odd-even * *   /^redscatinter .*/          xfail=csr/mpich-ofi#2014  test/mpi/coll/testlist
* gnu default sockets auto * *  /^icgatherv 5 .*/           xfail=csr/mpich-ofi#2195  test/mpi/coll/testlist
* * * * * * *                   /^too_many_icomms .*/       xfail=csr/mpich-ofi#1874  test/mpi/errors/comm/testlist
* * * * * * *                   /^too_many_icomms2 .*/      xfail=csr/mpich-ofi#1874  test/mpi/errors/comm/testlist
* * * * * * *                   /^too_many_icomms3 .*/      xfail=csr/mpich-ofi#1874  test/mpi/errors/comm/testlist
* * * * * * *                   /^truncmsg1 .*/             xfail=csr/mpich-ofi#1875  test/mpi/errors/pt2pt/testlist
* * debug * * * *               /^errinstatts .*/           xfail=csr/mpich-ofi#1887  test/mpi/errors/pt2pt/testlist
* * debug * * * *               /^errinstatta .*/           xfail=csr/mpich-ofi#1887  test/mpi/errors/pt2pt/testlist
* * debug * * * *               /^errinstatws .*/           xfail=csr/mpich-ofi#1887  test/mpi/errors/pt2pt/testlist
* * * * * * *                   /^errinstatwa .*/           xfail=csr/mpich-ofi#2046  test/mpi/errors/pt2pt/testlist
* * * * * * *                   /^win_sync_lock_fence .*/   xfail=csr/mpich-ofi#1877  test/mpi/errors/rma/testlist
* * * * * * *                   /^win_sync_op .*/           xfail=csr/mpich-ofi#1878  test/mpi/errors/rma/testlist
* * debug * netmod * *          /^i_bigtype .*/             xfail=csr/mpich-ofi#1911  test/mpi/io/testlist
* * default * auto * *          /^i_hindexed_io .*/         xfail=csr/mpich-ofi#1912  test/mpi/io/testlist
* * * psm2 * noam *             /^cmsplit2 .*/              xfail=csr/mpich-ofi#2125  test/mpi/comm/testlist
* * debug * no-odd-even noam *  /^huge_anysrc .*/           xfail=csr/mpich-ofi#2244  test/mpi/pt2pt/testlist

# cvarwrite changes the values of CVARs, which would change the behavior of a progress thread
# thus it won't be supported in the handoff mode
* * * * * * *  /^cvarwrite .*/  xfail=unsupported  test/mpi/mpi_t/testlist

# No triggerd op support
* * * * * * *  /^.* env=MPIR_CVAR_CH4_OFI_ENABLE_TRIGGERED=1 .*/  xfail=no_handoff_triggered_ops  test/mpi/coll/testlist.cvar

# xfail release gather
* * * * * * *  /^.*release_gather.*/  xfail=no_handoff_rg  test/mpi/coll/testlist.cvar

# NBC composition requires gentran scheduler (MPIR_CVAR_*_COMPOSITION)
* * * * * * *  /^.*_COMPOSITION=.*/  xfail=csr/mpich-ofi#1937  test/mpi/coll/testlist.cvar

# No gentran algorithms support
* * * * * * *  /^.*_ALGORITHM=gentran.*/  xfail=csr/mpich-ofi#1921  test/mpi/coll/testlist.cvar

# no-odd-even fails only for vci4, but we'll xfail them all here for simplicity
* * * sockets * * *  /^pingping [0-9]* arg=-type=.* arg=-sendcnt=.* .*/  xfail=csr/mpich-ofi#1028  test/mpi/pt2pt/testlist.dtp

* * * * no-odd-even * *  /^many_isend.*/  xfail=csr/mpich-ofi#2090  test/mpi/pt2pt/testlist
* * * * auto * *         /^many_isend.*/  xfail=csr/mpich-ofi#2090  test/mpi/pt2pt/testlist

* * default * netmod * *  /^nonblocking .*/   xfail=csr/mpich-ofi#1937  test/mpi/coll/testlist.cvar
* * default * netmod * *  /^nonblocking2 .*/  xfail=csr/mpich-ofi#1937  test/mpi/coll/testlist.cvar

# comm_idup family -- netmod and auto are covered in mt_xfail_vci4.conf
* * * * * * *        /^comm_idup_iallreduce .*/   xfail=csr/mpich-ofi#1942  test/mpi/comm/testlist
* * * * * * *        /^comm_idup_nb .*/           xfail=csr/mpich-ofi#1942  test/mpi/comm/testlist
* * * * * * *        /^comm_idup_isend .*/        xfail=csr/mpich-ofi#1942  test/mpi/comm/testlist
* * * psm2 auto * *  /^comm_idup_isend .*/        xfail=csr/mpich-ofi#1942  test/mpi/comm/testlist
* * * * * * *        /^idup_deadlock.*/           xfail=csr/mpich-ofi#1942  test/mpi/threads/comm/testlist
* * * * * * *        /^cmfree .*/                 xfail=csr/mpich-ofi#1944  test/mpi/comm/testlist
* * * * * * *        /^dup_leak_test .*/          xfail=csr/mpich-ofi#1943  test/mpi/threads/comm/testlist

* * * sockets * noam *  /^threads .*/  xfail=csr/mpich-ofi#1995  test/mpi/threads/pt2pt/testlist
