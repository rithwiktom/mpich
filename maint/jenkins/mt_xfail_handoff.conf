# Conditional XFAIL settings: Additions for the handoff mode of the VCI branch
#
# Syntax (similar to a cron file):
#   [jobname] [compiler] [jenkins_configure] [netmod] [shmem_config] [force_am] [pmix] [sed of XFAIL]
#   Note that the [jobname] allows partial matches (see examples). Other
#   conditions only allows exact matches.
#   The actual allowed combinations are depending on the Jenkins job. For
#   example,
#   per-commit * * opa1x * * sed -i "..."
#   will have no effect since none of the per-commit jobs has opa1x netmod in the
#   configuration.
#
# Examples:
#   nightly gnu debug sockets exclusive noam sed -i "..."
#   This will apply the set the XFAIL when the job is "nightly-ancc" or
#   "nightly", the compiler is "gnu", the jenkins_configure is
#   "debug", provider is "sockets", shm configuration is "exclusive",
#   and force_am configuration is "noam".
#
# Important note:
#   The BSD sed on FreeBSD and OSX nodes has different parameters than the GNU
#   sed. You should use `gsed` than `sed` on them.
#
# For each build, all applied XFAILS will be summarized in
# ${SOURCE}/apply-xfail.sh
#
################################################################################

# Disable subdirectories
* * * * * * * sed -i "s+ft+\#ft+g" test/mpi/testlist

# Disable rma atomic test requiring AM path
* * * * * * * sed -i "s+\(^atomic_get_2int .*\)+\1 xfail=csr/mpich-ofi#1684+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^atomic_get_long_int .*\)+\1 xfail=csr/mpich-ofi#1684+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^atomic_get_float_int .*\)+\1 xfail=csr/mpich-ofi#1684+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^atomic_get_double_int .*\)+\1 xfail=csr/mpich-ofi#1684+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^atomic_get_long_double_int .*\)+\1 xfail=csr/mpich-ofi#1684+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^atomic_rmw_cas .*\)+\1 xfail=csr/mpich-ofi#1684+g" test/mpi/rma/testlist
* * * * no-odd-even * * sed -i "s+\(^atomic_get_short_int .*\)+\1 xfail=csr/mpich-ofi#1908+g" test/mpi/rma/testlist

# MT tests
* * * * * * * sed -i "s+\(^mt_compareandswap .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/threads/rma/testlist
* * debug * * * * sed -i "s+\(^multifence .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/threads/rma/testlist
* gnu default psm2 auto noam * sed -i "s+\(^multirma .*\)+\1 xfail=csr/mpich-ofi#2258+g" test/mpi/threads/rma/testlist

# Non-MT tests
# (from master) pingping tests with large testsize currently fails async tests due to netmod handling of large message queue
* * * * * * * sed -i "s+\(^pingping .*testsize=32.*\)+\1 xfail=issue4474+g" test/mpi/pt2pt/testlist.dtp
* gnu debug psm2 netmod * * sed -i "s+\(^large_small_acc 2.*\)+\1 xfail=csr/mpich-ofi#2131+g" test/mpi/rma/testlist
* icc debug psm2 netmod no-odd-even * sed -i "s+\(^large_small_acc 2.*\)+\1 xfail=csr/mpich-ofi#2131+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^lockall_dt.*\)+\1 xfail=csr/mpich-ofi#1744+g" test/mpi/rma/testlist.dtp
* * * psm2 * * * sed -i "s+\(^lock_dt .*\)+\1 xfail=csr/mpich-ofi#1975+g" test/mpi/rma/testlist.dtp
* * * psm2 * * * sed -i "s+\(^lock_dt_flush .*\)+\1 xfail=csr/mpich-ofi#1975+g" test/mpi/rma/testlist.dtp
* * * psm2 * * * sed -i "s+\(^lockall_dt_flushall .*\)+\1 xfail=csr/mpich-ofi#1975+g" test/mpi/rma/testlist.dtp
* gnu default psm2 auto * * sed -i "s+\(^lock_dt_flushlocal 2 -type=MPI_INT -count=65530 -seed=182 -testsize=16 .*\)+\1 xfail=csr/mpich-ofi#2135+g" test/mpi/rma/testlist.dtp
* * * * * * * sed -i "s+\(^accfence1.* .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist.dtp
* * * * * * * sed -i "s+\(^getfence1.* .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist.dtp
* * * * * * * sed -i "s+\(^epochtest[a-z0-9A-Z_]* .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist.dtp
* * * * * * * sed -i "s+\(^manyrma2[a-z0-9A-Z_]* .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^fetch_and_op[a-z0-9A-Z_]* .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^get_accumulate_[a-z0-9A-Z_]* .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^at_complete .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist
* * debug * * * * sed -i "s+\(^win_shared_noncontig_put .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist
* * debug * * * * sed -i "s+\(^acc_ordering .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist
* * debug * * * * sed -i "s+\(^win_dynamic_acc .*\)+\1 xfail=csr/mpich-ofi#1319+g" test/mpi/rma/testlist
* * * * * * * sed -i "s+\(^winfencex .*\)+\1 xfail=csr/mpich-ofi#1938+g" test/mpi/cxx/rma/testlist
* * debug * * * * sed -i "s+\(^winfencef .*\)+\1 xfail=csr/mpich-ofi#1938+g" test/mpi/f77/rma/testlist
* * debug * * * * sed -i "s+\(^winfencef90 .*\)+\1 xfail=csr/mpich-ofi#1938+g" test/mpi/f90/rma/testlist
* * debug * * * * sed -i "s+\(^wingetf .*\)+\1 xfail=csr/mpich-ofi#1938+g" test/mpi/f77/rma/testlist
* * debug * * * * sed -i "s+\(^wingetf90 .*\)+\1 xfail=csr/mpich-ofi#1938+g" test/mpi/f90/rma/testlist
* * debug * * * * sed -i "s+\(^wingetf08 .*\)+\1 xfail=csr/mpich-ofi#1938+g" test/mpi/f08/rma/testlist
* * debug * * * * sed -i "s+\(^mixedsync .*\)+\1 xfail=csr/mpich-ofi#1939+g" test/mpi/rma/testlist
* * debug * * * * sed -i "s+\(^winaccf .*\)+\1 xfail=csr/mpich-ofi#1939+g" test/mpi/f77/rma/testlist
* * debug * * * * sed -i "s+\(^winaccf90 .*\)+\1 xfail=csr/mpich-ofi#1939+g" test/mpi/f90/rma/testlist
* * debug * * * * sed -i "s+\(^winaccf08 .*\)+\1 xfail=csr/mpich-ofi#1939+g" test/mpi/f08/rma/testlist
* * * psm2 auto * * sed -i "s+\(^lock_contention_dt 4 arg=-type=MPI_INT arg=-count=65530 arg=-seed=149 arg=-testsize=16 .*\)+\1 xfail=csr/mpich-ofi#1974+g" test/mpi/rma/testlist.dtp
* * debug * * * * sed -i "s+\(^putfence1 .*\)+\1 xfail=csr/mpich-ofi#1369+g" test/mpi/rma/testlist.dtp
* gnu default * auto * * sed -i "s+\(^acc_loc .*\)+\1 xfail=csr/mpich-ofi#1931+g" test/mpi/rma/testlist

* gnu default psm2 auto * * sed -i "s+\(^allred5 5 env=MPIR_CVAR_ALLREDUCE_DEVICE_COLLECTIVE=0 env=MPIR_CVAR_ALLREDUCE_INTRA_ALGORITHM=nb env=MPIR_CVAR_IALLREDUCE_DEVICE_COLLECTIVE=0.*\)+\1 xfail=csr/mpich-ofi#1986+g" test/mpi/coll/testlist.cvar

* * * * no-odd-even * * sed -i "s+\(^redscatbkinter .*\)+\1 xfail=csr/mpich-ofi#1999+g" test/mpi/coll/testlist
* icc default psm2 auto * * sed -i "s+\(^redscatbkinter 10 .*\)+\1 xfail=csr/mpich-ofi#2136+g" test/mpi/coll/testlist
* * * sockets no-odd-even * * sed -i "s+\(^redscatinter .*\)+\1 xfail=csr/mpich-ofi#2014+g" test/mpi/coll/testlist
* gnu default sockets auto * * sed -i "s+\(^icgatherv 5 .*\)+\1 xfail=csr/mpich-ofi#2195+g" test/mpi/coll/testlist
* * * * * * * sed -i "s+\(^too_many_icomms .*\)+\1 xfail=csr/mpich-ofi#1874+g" test/mpi/errors/comm/testlist
* * * * * * * sed -i "s+\(^too_many_icomms2 .*\)+\1 xfail=csr/mpich-ofi#1874+g" test/mpi/errors/comm/testlist
* * * * * * * sed -i "s+\(^too_many_icomms3 .*\)+\1 xfail=csr/mpich-ofi#1874+g" test/mpi/errors/comm/testlist
* * * * * * * sed -i "s+\(^truncmsg1 .*\)+\1 xfail=csr/mpich-ofi#1875+g" test/mpi/errors/pt2pt/testlist
* * debug * * * * sed -i "s+\(^errinstatts .*\)+\1 xfail=csr/mpich-ofi#1887+g" test/mpi/errors/pt2pt/testlist
* * debug * * * * sed -i "s+\(^errinstatta .*\)+\1 xfail=csr/mpich-ofi#1887+g" test/mpi/errors/pt2pt/testlist
* * debug * * * * sed -i "s+\(^errinstatws .*\)+\1 xfail=csr/mpich-ofi#1887+g" test/mpi/errors/pt2pt/testlist
* * * * * * * sed -i "s+\(^errinstatwa .*\)+\1 xfail=csr/mpich-ofi#2046+g" test/mpi/errors/pt2pt/testlist
* * * * * * * sed -i "s+\(^win_sync_lock_fence .*\)+\1 xfail=csr/mpich-ofi#1877+g" test/mpi/errors/rma/testlist
* * * * * * * sed -i "s+\(^win_sync_op .*\)+\1 xfail=csr/mpich-ofi#1878+g" test/mpi/errors/rma/testlist
* * debug * netmod * * sed -i "s+\(^i_bigtype .*\)+\1 xfail=csr/mpich-ofi#1911+g" test/mpi/io/testlist
* * default * auto * * sed -i "s+\(^i_hindexed_io .*\)+\1 xfail=csr/mpich-ofi#1912+g" test/mpi/io/testlist
* * * psm2 * noam * sed -i "s+\(^cmsplit2 .*\)+\1 xfail=csr/mpich-ofi#2125+g" test/mpi/comm/testlist
* * debug * no-odd-even noam * sed -i "s+\(^huge_anysrc .*\)+\1 xfail=csr/mpich-ofi#2244+g" test/mpi/pt2pt/testlist

# cvarwrite changes the values of CVARs, which would change the behavior of a progress thread
# thus it won't be supported in the handoff mode
* * * * * * * sed -i "s+\(^cvarwrite .*\)+\1 xfail=unsupported+g" test/mpi/mpi_t/testlist

# No triggerd op support
* * * * * * * sed -i "s+\(^.* env=MPIR_CVAR_CH4_OFI_ENABLE_TRIGGERED=1 .*\)+\1 xfail=no_handoff_triggered_ops+g" test/mpi/coll/testlist.cvar

# xfail release gather
* * * * * * * sed -i "s+\(^.*release_gather.*\)+\1 xfail=no_handoff_rg+g" test/mpi/coll/testlist.cvar

# NBC composition requires gentran scheduler (MPIR_CVAR_*_COMPOSITION)
* * * * * * * sed -i "s+\(^.*_COMPOSITION=.*\)+\1 xfail=csr/mpich-ofi#1937+g" test/mpi/coll/testlist.cvar

# No gentran algorithms support
* * * * * * * sed -i "s+\(^.*_ALGORITHM=gentran.*\)+\1 xfail=csr/mpich-ofi#1921+g" test/mpi/coll/testlist.cvar

# no-odd-even fails only for vci4, but we'll xfail them all here for simplicity
* * * sockets * * * sed -i "s+\(^pingping [0-9]* arg=-type=.* arg=-sendcnt=.* .*\)+\1 xfail=csr/mpich-ofi#1028+g" test/mpi/pt2pt/testlist.dtp

* * * * no-odd-even * * sed -i "s+\(^many_isend.*\)+\1 xfail=csr/mpich-ofi#2090+g" test/mpi/pt2pt/testlist
* * * * auto * * sed -i "s+\(^many_isend.*\)+\1 xfail=csr/mpich-ofi#2090+g" test/mpi/pt2pt/testlist

* * default * netmod * * sed -i "s+\(^nonblocking .*\)+\1 xfail=csr/mpich-ofi#1937+g" test/mpi/coll/testlist.cvar
* * default * netmod * * sed -i "s+\(^nonblocking2 .*\)+\1 xfail=csr/mpich-ofi#1937+g" test/mpi/coll/testlist.cvar

# comm_idup family -- netmod and auto are covered in mt_xfail_vci4.conf
* * * * * * * sed -i "s|\(^comm_idup_iallreduce .*\)|\1 xfail=csr/mpich-ofi#1942|g" test/mpi/comm/testlist
* * * * * * * sed -i "s|\(^comm_idup_nb .*\)|\1 xfail=csr/mpich-ofi#1942|g" test/mpi/comm/testlist
* * * * * * * sed -i "s|\(^comm_idup_isend .*\)|\1 xfail=csr/mpich-ofi#1942|g" test/mpi/comm/testlist
* * * psm2 auto * * sed -i "s|\(^comm_idup_isend .*\)|\1 xfail=csr/mpich-ofi#1942|g" test/mpi/comm/testlist
* * * * * * * sed -i "s|\(^idup_deadlock.*\)|\1 xfail=csr/mpich-ofi#1942|g" test/mpi/threads/comm/testlist
* * * * * * * sed -i "s|\(^cmfree .*\)|\1 xfail=csr/mpich-ofi#1944|g" test/mpi/comm/testlist
* * * * * * * sed -i "s|\(^dup_leak_test .*\)|\1 xfail=csr/mpich-ofi#1943|g" test/mpi/threads/comm/testlist

* * * sockets * noam * sed -i "s+\(^threads .*\)+\1 xfail=csr/mpich-ofi#1995+g" test/mpi/threads/pt2pt/testlist
